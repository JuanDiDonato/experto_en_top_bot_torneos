<!DOCTYPE html>
<html>
  <head>
    <title>Smelly Python code smell report</title>
    <link href="../style.css" rel="stylesheet">
    <link href="../idea.min.css" rel="stylesheet">
  </head>
  <body>
    <h1>Smelly Python</h1>
    <div id="src/bot.py">
      <h4>
        <a href="../index.html">Home</a> &gt; src/bot.py
      </h4>
      <pre id="code-block"><code class="language-python"># -*- coding: utf-8 -*-

import os
import datetime
import threading
import time
from threading import Timer
from datetime import date

import discord
from dotenv import load_dotenv
from discord.ext import commands

from league.league import Tournament
from threadings import Threadings
from embed import Embed

# Variables de entorno
load_dotenv()
TOKEN = os.getenv(&quot;TOKEN&quot;)

# Gestion de mensajes
msg = Embed()

# Threading
th = Threadings()

bot = commands.Bot(command_prefix='.')  # prefix del bot


&quot;&quot;&quot;
Funcion para manejar intevalos
&quot;&quot;&quot;
def setInterval(timer, task):
    isStop = task()
    if not isStop:
        Timer(timer, setInterval, [timer, task]).start()
    
&quot;&quot;&quot;
Evento de inicio del bot
&quot;&quot;&quot;
@bot.event
async def on_ready(): 
    await bot.change_presence(activity=discord.Game(name=&quot;.comandos para mas info!&quot;))
    print(&quot;Bot conectado&quot;)
    auto_sync_thr = threading.Thread(target=auto_sync,name=&quot;auto_sync&quot;)
    auto_sync_thr.start()
    

&quot;&quot;&quot;
Threading que ejecuta la busqueda de usuarios
&quot;&quot;&quot;
def get_summoners():
    get_summ = threading.Thread(target=th.tr_get_summoners, name='get_summoners')
    if not get_summ.is_alive():
        get_summ.start()

&quot;&quot;&quot;
Threading que ejecuta la busqueda de torneos
&quot;&quot;&quot;
def sync_tournament():
    get_tour = threading.Thread(target=th.tr_sync_tournament, name='sync_tournament')
    if not get_tour.is_alive():
        get_tour.start()

&quot;&quot;&quot;
Threading que ejecuta la syncro con la api de riot
&quot;&quot;&quot;
def update_history():
    get_hist = threading.Thread(target=th.tr_update_history, name='update_history')
    if not get_hist.is_alive():
        get_hist.start()

&quot;&quot;&quot;
Retorna informacion del servidor
&quot;&quot;&quot;
@bot.command()
async def info(ctx):
    await msg.show_server_info(ctx)
    
&quot;&quot;&quot;
Muestra los comandos del bot
&quot;&quot;&quot;
@bot.command()
async def comandos(ctx):
    await msg.show_commands(ctx)

&quot;&quot;&quot;
Muestra las fechas del torneo
&quot;&quot;&quot;
@bot.command()
async def fechas(ctx):
    await msg.show_rounds(ctx,th.rounds_saved)

&quot;&quot;&quot;
Guarda el nombre de invocador en la base de datos
&quot;&quot;&quot;
@bot.command()
async def guardar(ctx,*args):
    data = [item for item in args]
    if len(data) &gt; 2:
        player = {'player_ds_id':data[0],&quot;player_lol_name&quot;: ''.join(e + ' ' for e in data[1:])} # Guarda el nombre con espacios
    else:
        player = {'player_ds_id':data[0],&quot;player_lol_name&quot;: data[1]} # Guarda el nombre sin espacios
    th.db.insert_one_player(player)
    await ctx.send(f&quot;{data[0]} guardado.&quot;)

&quot;&quot;&quot;
Genera la tabla de puntos
&quot;&quot;&quot;
async def puntos(ctx,players):
    list_players = []
    for i in players:
        th.points[i] = 0
        if th.summoners.get(i) == None or th.summoners.get(i) == i:
            await ctx.send(f&quot;ðŸš¨ {i} no esta guardado. Usa el comando '.guardar {i} + nombre en lol' ðŸš¨&quot;)
            list_players.append({&quot;player_ds_id&quot;:i,&quot;player_lol_name&quot;:i})
    th.db.insert_many_players(list_players)

&quot;&quot;&quot;
Muestra en el canal de ds las estadisticas 
&quot;&quot;&quot;
async def display_wins(ctx,data):
    for d in data:
        await msg.show_stats(ctx,d)

&quot;&quot;&quot;
Ordena las estadisticas obtenidas desde la api de riot
&quot;&quot;&quot;
@bot.command()
async def partidas(ctx):
    wins_by_summoners = []
    if len(th.stadistics) &gt; 0:
        for s in th.stadistics:
            if s['summoner'] != &quot;Fecha libre&quot;:
                summoner_data = {}
                wins = {}
                defeat = {}
                played = {}
                win_count = 0
                def_count = 0
                try:
                    for p in s['statistics']:
                        try: played[p['champ']] = played[p['champ']] + 1
                        except: played[p['champ']] = 1
                        if p['win'] == True:
                            win_count = win_count + 1
                            try:
                                wins[p['champ']] = wins[p['champ']] + 1
                            except:
                                wins[p['champ']] = 1
                        else:
                            def_count = def_count + 1
                            try:
                                defeat[p['champ']] = defeat[p['champ']] + 1
                            except:
                                defeat[p['champ']] = 1
                except:
                    continue
                summoner_data[&quot;wins&quot;] = wins
                summoner_data[&quot;defeats&quot;] = defeat
                summoner_data[&quot;played&quot;] = played
                summoner_data['summoner'] = s['summoner']
                if len(s['statistics']) == 0:
                    summoner_data['wins_p'] = f&quot;{s['summoner']} no jugo en los ultimos 3 dias :(&quot;
                else:
                    summoner_data['wins_p'] = win_count / len(s['statistics'])
                wins_by_summoners.append(summoner_data)
        await display_wins(ctx,wins_by_summoners)
    else: 
        await msg.not_data(ctx)

&quot;&quot;&quot;
Crea la liga con una lista de jugadores
&quot;&quot;&quot;
@bot.command()
async def liga(ctx,*args):
    if len(th.rounds_saved) == 0 and len(th.players_saved) == 0:
        players = [item for item in args]  # Convierte los argumentos a una lista
        league = Tournament(players)
        rounds = league.Generate()
        th.rounds_saved.extend(rounds)
        th.players_saved.extend(players)
        await puntos(ctx,players) # Crea una tabla de puntos inicial, con cero puntos para cada participante
        created = th.db.insert_tournament({&quot;rounds&quot;: rounds, &quot;players&quot;:players, &quot;points&quot;:th.points, &quot;name&quot;:&quot;Los Pibardos&quot;})
        if created == False:
            th.points.clear()
            th.players_saved.clear()
            th.rounds_saved.clear()
            await msg.err_tournament(ctx)
        else:
            await ctx.send(&quot;Creando liga...&quot;)
            await msg.show_rounds(ctx,rounds)
            sync()
    else:
        await msg.err_tournament(ctx)

&quot;&quot;&quot;
Muestra la tabla de puntuacion de cada participante del torneo
&quot;&quot;&quot;
@bot.command()
async def tabla(ctx):
    await msg.show_points(ctx,th.points)

&quot;&quot;&quot;
Suma un punto a un jugador
&quot;&quot;&quot;
@bot.command()
async def para(ctx,player):
    try:
        if th.points[player] &gt;= 0:
            th.points[player] += 1
            await ctx.send(f&quot;Se agrego un punto a {player}&quot;)
            await tabla(ctx)
            th.db.update_tournament(th.points)
        else:
            await ctx.send(f&quot;{player} no esta en este torneo&quot;)
    except:
        await ctx.send(f&quot;{player} no esta en este torneo&quot;)

&quot;&quot;&quot;
Elimina todos los puntos del torneo
&quot;&quot;&quot;
@bot.command()
async def reiniciar(ctx):
    if len(th.rounds_saved) &gt; 0 and len(th.players_saved) &gt; 0:
        th.points.clear()
        for p in th.players_saved:
            th.points[p] = 0
        th.db.update_tournament(th.points)  # Actualiza la base de datos
        await msg.rest_points_tournament(ctx)
        await tabla(ctx)
    else:
        await msg.err_not_tournament(ctx)

&quot;&quot;&quot;
Borra el torneo activo
&quot;&quot;&quot;
@bot.command()
async def borrar(ctx):
    if len(th.rounds_saved) &gt; 0 and len(th.players_saved) &gt; 0:
        th.db.delete_tournament()
        await msg.tournament_deleted(ctx)
        sync()
    else:
        await msg.err_not_tournament(ctx)

&quot;&quot;&quot;
Ejecuta las funciones para obtener el torneo activo desde la base de datos y las
estadisticas desde la api de riot
Solo hace la syncro si no esta hay activa ninguna otra
&quot;&quot;&quot;
def sync():
    fuctions_thr = {
        &quot;get_summoners&quot; : get_summoners,
        &quot;sync_tournament&quot; : sync_tournament,
        &quot;update_history&quot; : update_history
    }
    sync_active = {
        &quot;get_summoners&quot; : False,
        &quot;sync_tournament&quot; : False,
        &quot;update_history&quot; : False
    }
    for thr in threading.enumerate():
        if thr.name == &quot;get_summoner&quot; or thr.name == &quot;sync_tournament&quot; or thr.name == &quot;update_history&quot; :
            sync_active[thr.name] = True

    for k,v in sync_active.items():
        if v == False:
            fuctions_thr[k]()
                   
&quot;&quot;&quot;
Sincronizacion de datos automatica
&quot;&quot;&quot;
def auto_sync():
    while True:
        sync()
        time.sleep(600)  # diez minutos

if &quot;__main__&quot; == __name__:
    bot.run(TOKEN)





</code></pre>
    </div>
    <footer>
      <script src="..//highlight.min.js"></script>
      <script src="..//highlightjs-line-numbers.min.js"></script>
      <script>hljs.highlightAll();</script>
      <script src="..//script.js"></script>
      <script>setSmells([{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 38, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "trailing-whitespace", "message": "Trailing whitespace", "message_id": "C0303", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 43, "column": 21, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "trailing-whitespace", "message": "Trailing whitespace", "message_id": "C0303", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 48, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "trailing-whitespace", "message": "Trailing whitespace", "message_id": "C0303", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 80, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "trailing-whitespace", "message": "Trailing whitespace", "message_id": "C0303", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 102, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "line-too-long", "message": "Line too long (127/100)", "message_id": "C0301", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 116, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "line-too-long", "message": "Line too long (102/100)", "message_id": "C0301", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 170, "column": 9, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "trailing-whitespace", "message": "Trailing whitespace", "message_id": "C0303", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 184, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "line-too-long", "message": "Line too long (108/100)", "message_id": "C0301", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 185, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "line-too-long", "message": "Line too long (123/100)", "message_id": "C0301", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 265, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "line-too-long", "message": "Line too long (104/100)", "message_id": "C0301", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 271, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "trailing-whitespace", "message": "Trailing whitespace", "message_id": "C0303", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 286, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "trailing-newlines", "message": "Trailing newlines", "message_id": "C0305", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "", "line": 1, "column": 0, "end_line": null, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-module-docstring", "message": "Missing module docstring", "message_id": "C0114", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "setInterval", "line": 34, "column": 0, "end_line": 34, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "setInterval", "line": 34, "column": 0, "end_line": 34, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "invalid-name", "message": "Function name \"setInterval\" doesn't conform to snake_case naming style", "message_id": "C0103", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "setInterval", "line": 35, "column": 4, "end_line": 35, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "invalid-name", "message": "Variable name \"isStop\" doesn't conform to snake_case naming style", "message_id": "C0103", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "on_ready", "line": 43, "column": 0, "end_line": 43, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "get_summoners", "line": 53, "column": 0, "end_line": 53, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "sync_tournament", "line": 61, "column": 0, "end_line": 61, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "update_history", "line": 69, "column": 0, "end_line": 69, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "info", "line": 78, "column": 0, "end_line": 78, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "comandos", "line": 85, "column": 0, "end_line": 85, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "fechas", "line": 92, "column": 0, "end_line": 92, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "guardar", "line": 99, "column": 0, "end_line": 99, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "puntos", "line": 111, "column": 0, "end_line": 111, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "puntos", "line": 115, "column": 11, "end_line": 115, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "singleton-comparison", "message": "Comparison 'th.summoners.get(i) == None' should be 'th.summoners.get(i) is None'", "message_id": "C0121", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "display_wins", "line": 123, "column": 0, "end_line": 123, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "display_wins", "line": 124, "column": 8, "end_line": 124, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "invalid-name", "message": "Variable name \"d\" doesn't conform to snake_case naming style", "message_id": "C0103", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "partidas", "line": 131, "column": 0, "end_line": 131, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "partidas", "line": 134, "column": 12, "end_line": 134, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "invalid-name", "message": "Variable name \"s\" doesn't conform to snake_case naming style", "message_id": "C0103", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "partidas", "line": 143, "column": 24, "end_line": 143, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "invalid-name", "message": "Variable name \"p\" doesn't conform to snake_case naming style", "message_id": "C0103", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "partidas", "line": 144, "column": 29, "end_line": 144, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "multiple-statements", "message": "More than one statement on a single line", "message_id": "C0321", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "partidas", "line": 145, "column": 32, "end_line": 145, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "multiple-statements", "message": "More than one statement on a single line", "message_id": "C0321", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "partidas", "line": 146, "column": 27, "end_line": 146, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "singleton-comparison", "message": "Comparison 'p['win'] == True' should be 'p['win'] is True' if checking for the singleton value True, or 'p['win']' if testing for truthiness", "message_id": "C0121", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "liga", "line": 177, "column": 0, "end_line": 177, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "liga", "line": 186, "column": 11, "end_line": 186, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "singleton-comparison", "message": "Comparison 'created == False' should be 'created is False' if checking for the singleton value False, or 'not created' if testing for falsiness", "message_id": "C0121", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "tabla", "line": 202, "column": 0, "end_line": 202, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "para", "line": 209, "column": 0, "end_line": 209, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "reiniciar", "line": 225, "column": 0, "end_line": 225, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "reiniciar", "line": 228, "column": 12, "end_line": 228, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "invalid-name", "message": "Variable name \"p\" doesn't conform to snake_case naming style", "message_id": "C0103", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "borrar", "line": 240, "column": 0, "end_line": 240, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "sync", "line": 253, "column": 0, "end_line": 253, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "sync", "line": 268, "column": 10, "end_line": 268, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "invalid-name", "message": "Variable name \"v\" doesn't conform to snake_case naming style", "message_id": "C0103", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "sync", "line": 269, "column": 11, "end_line": 269, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "singleton-comparison", "message": "Comparison 'v == False' should be 'v is False' if checking for the singleton value False, or 'not v' if testing for falsiness", "message_id": "C0121", "severity": 0},{"type": "convention", "location": {"module": "bot", "python_object": "auto_sync", "line": 275, "column": 0, "end_line": 275, "path": "src/bot.py", "severity": 0, "type": "convention"}, "symbol": "missing-function-docstring", "message": "Missing function or method docstring", "message_id": "C0116", "severity": 0}])</script>
    </footer>
  </body>
</html>